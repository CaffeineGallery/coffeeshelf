#!/bin/bash
# üóÉÔ∏è CoffeeShelf - Terminal Shelf Dashboard for Coffee Shell

# Plugin metadata
SHELF_DIR="$HOME/.caffeine/plugins/coffeeshelf"
CONFIG_FILE="$SHELF_DIR/config.conf"
MODULES_DIR="$SHELF_DIR/modules"

# Create a config if doesn't exist
if [[ ! -f "$SHELF_DIR/config" ]]; then
    touch "$SHELF_DIR/config"
fi

# Load config
source "$CONFIG_FILE"



# Load modules
load_modules() {
  for module in "${MODULES[@]}"; do
    MODULE_PATH="$MODULES_DIR/$module.sh"
    if [[ -f "$MODULE_PATH" ]]; then
      source "$MODULE_PATH"
    else
      echo "‚ö†Ô∏è Module $module not found."
    fi
  done
}

# TUI Display
show_shelf() {
  while true; do
    clear
    echo -e "\e[1;32müóÉÔ∏è CoffeeShelf - Your Coffee Dashboard\e[0m"
    echo "--------------------------------------"
    echo

    for widget in "${WIDGETS[@]}"; do
      if declare -f "$widget" > /dev/null; then
        "$widget"
      else
        echo "‚ö†Ô∏è  Widget function '$widget' not found."
      fi
      echo
    done

    echo "--------------------------------------"
    echo "[r] Reload shelf"
    echo "[q] Quit"
    read -e -rp "‚ùì Option: " choice
    case "$choice" in
      q|Q) break ;;
      r|R|"") continue ;;
      *) echo "‚ö†Ô∏è Unknown option."; sleep 1 ;;
    esac
  done
}



# Run the shelf
main() {
  mkdir -p "$SHELF_DIR/logs"
  load_modules
  show_shelf
}

main
